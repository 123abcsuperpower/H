local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TweenService = game:GetService("TweenService")
local VirtualUser = game:GetService("VirtualUser")

local player = Players.LocalPlayer
local targetPlaceId = 6284182556
local remoteEvent = ReplicatedStorage:WaitForChild("Events"):WaitForChild("ChangeDimension")

local respawnCFrame = CFrame.new(
    -444.333008, 1011.56787, 685.085754,
    -0.893259048, -0.0212173164, 0.449041277,
    -0.0232571326, 0.999729037, 0.000973013404,
    -0.448940247, -0.00957425963, -0.893510461
)

-- Anti-idle
player.Idled:Connect(function()
    VirtualUser:CaptureController()
    VirtualUser:ClickButton2(Vector2.new())
end)

-- Tween + equip logic
local function tweenToPosition()
    local character = player.Character or player.CharacterAdded:Wait()
    local hrp = character:WaitForChild("HumanoidRootPart")

    -- Instant tween to initial position
    local instantTween = TweenService:Create(hrp, TweenInfo.new(0.1, Enum.EasingStyle.Linear), {
        CFrame = respawnCFrame
    })
    instantTween:Play()
    instantTween.Completed:Wait()

    -- Tween 40 studs backward
    local backCFrame = respawnCFrame * CFrame.new(0, 0, -40)
    local backTween = TweenService:Create(hrp, TweenInfo.new(1, Enum.EasingStyle.Sine), {
        CFrame = backCFrame
    })
    backTween:Play()
    backTween.Completed:Wait()

    -- Tween forward to original
    local forwardTween = TweenService:Create(hrp, TweenInfo.new(1, Enum.EasingStyle.Sine), {
        CFrame = respawnCFrame
    })
    forwardTween:Play()
    forwardTween.Completed:Wait()

    -- Equip Psychic
    local tool = player.Backpack:FindFirstChild("Psychic")
    if tool then
        tool.Parent = character
    end
end

-- Main logic
if game.PlaceId ~= targetPlaceId then
    remoteEvent:FireServer()
else
    tweenToPosition()
    player.CharacterAdded:Connect(function()
        task.wait(1)
        tweenToPosition()
    end)
end
